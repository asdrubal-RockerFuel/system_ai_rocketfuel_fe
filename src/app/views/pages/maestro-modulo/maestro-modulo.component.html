<div class="breadcrumb">
  <h1>Módulos</h1>
  <ul>
    <li><a>Lista de Módulos</a></li>
  </ul>
</div>
<div class="separator-breadcrumb border-top"></div>
<div class="col-md-12" style="text-align: end">
  <button
    class="btn btn-outline-info btn-rounded"
    (click)="openCategoriasAdd(addProductos)"
  >
    Agregar
  </button>
</div>
<div class="row mt-3">
  <div
    style="
      display: flex;
      width: 100%;
      justify-content: center;
      margin-bottom: 1rem;
    "
    *ngIf="loadData"
  >
    <div class="loader-bubble loader-bubble-info m-4"></div>
  </div>

  <div class="col-md-12">
    <div class="card o-hidden">
      <div
        style="padding-left: 20px"
        *ngIf="!allUser?.length"
        class="w-100 my-4 mx-auto"
      >
        <h4>{{ "Sin Módulos agregados" }}</h4>
      </div>

      <ngx-datatable
        *ngIf="allUser?.length"
        style="box-shadow: none"
        class="material fullscreen"
        [style.height]="60 * allUser.length + 60 + 'px'"
        [columnMode]="'force'"
        [headerHeight]="50"
        [footerHeight]="0"
        [rowHeight]="60"
        [scrollbarV]="true"
        [scrollbarH]="true"
        [rows]="allUser"
      >
        <ngx-datatable-column [resizeable]="false" [sortable]="false">
          <ng-template ngx-datatable-header-template> Nombre </ng-template>
          <ng-template
            ngx-datatable-cell-template
            let-value="value"
            let-row="row"
          >
            {{ row.offices[0].oficina_name }}
          </ng-template>
        </ngx-datatable-column>

        <ngx-datatable-column [resizeable]="false" [sortable]="false">
          <ng-template ngx-datatable-header-template>
            Nombre del programa
          </ng-template>
          <ng-template
            ngx-datatable-cell-template
            let-value="value"
            let-row="row"
          >
            {{ row.area_name }}
          </ng-template>
        </ngx-datatable-column>

        <!--      <ngx-datatable-column [resizeable]="false" [sortable]="false">
            <ng-template ngx-datatable-header-template> Moneda </ng-template>
            <ng-template
              ngx-datatable-cell-template
              let-value="value"
              let-row="row"
            >
              {{ row.currency }}
            </ng-template>
          </ngx-datatable-column>
  
          <ngx-datatable-column [resizeable]="false" [sortable]="false">
            <ng-template ngx-datatable-header-template> Marca </ng-template>
            <ng-template
              ngx-datatable-cell-template
              let-value="value"
              let-row="row"
            >
              {{ row.brand }}
            </ng-template>
          </ngx-datatable-column> -->

        <ngx-datatable-column [resizeable]="false" [sortable]="false">
          <ng-template ngx-datatable-header-template> Estado </ng-template>
          <ng-template
            ngx-datatable-cell-template
            let-value="value"
            let-row="row"
          >
            <a
              class="m-0 text-muted text-small w-15 w-sm-15 cortado"
              *ngIf="row.state == true"
            >
              <div
                style="
                  border: 1px solid #b24732;
                  background: white;
                  color: black;
                  font-weight: 400;
                "
                class="badge badge-pill badge-success p-2 item-title"
              >
                Habilitado
              </div>
            </a>

            <a
              class="m-0 text-muted text-small w-15 w-sm-15 cortado"
              *ngIf="row.state == false"
            >
              <div
                style="
                  border: 1px solid #b24732;
                  background: white;
                  color: black;
                  font-weight: 400;
                "
                class="badge badge-pill badge-success p-2 item-title"
              >
                Deshabilitado
              </div>
            </a>
          </ng-template>
        </ngx-datatable-column>

        <ngx-datatable-column
          [resizeable]="false"
          [sortable]="false"
          [width]="120"
        >
          <ng-template ngx-datatable-header-template> Acciones </ng-template>
          <ng-template
            ngx-datatable-cell-template
            let-value="value"
            let-row="row"
          >
            <button
              (click)="confirm(i, row, modalEdit)"
              class="btn btn-wide btn-outline-secondary mr-3"
            >
              Editar
            </button>
            <button
              class="btn btn-outline-danger"
              (click)="deleteInvoice(row, deleteConfirmModal)"
            >
              <a *ngIf="row.state == true">Desactivar</a>
              <a *ngIf="row.state == false">Activar</a>
            </button>
          </ng-template>
        </ngx-datatable-column>
      </ngx-datatable>

      <ngb-pagination
        style="text-align: end"
        class="paginacion-ed"
        [collectionSize]="collectionSize"
        [(page)]="page"
        [pageSize]="pageSize"
        [maxSize]="5"
        (pageChange)="cambiaPage($event)"
      >
      </ngb-pagination>
    </div>
  </div>
</div>
<ng-template #deleteConfirmModal let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-title">¡Advertencia!</h4>
    <button
      type="button"
      class="close"
      aria-label="Close button"
      aria-describedby="modal-title"
      (click)="modal.dismiss('Cross click')"
    >
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <p>
      <strong
        >¿Está seguro de <a *ngIf="eve == true">activar</a>
        <a *ngIf="eve == false">desactivar</a> el Modulo?</strong
      >
    </p>
  </div>
  <div class="modal-footer">
    <button
      type="button"
      class="btn btn-outline-secondary btn-rounded"
      (click)="modal.dismiss('cancel')"
    >
      Cancelar
    </button>
    <button
      type="button"
      ngbAutofocus
      class="btn btn-wide btn-danger btn-rounded"
      (click)="modal.close('Ok')"
    >
      Aceptar
    </button>
  </div>
</ng-template>

<ng-template #addProductos>
  <div class="modal-header">
    <h2 mat-dialog-title class="modal-title">Agregar Módulo</h2>

    <button
      type="button"
      class="close"
      aria-label="Close"
      (click)="cerrarModal()"
    >
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <form [formGroup]="myForm">
      <div class="row" style="margin-top: 30px">
        <div class="form-group col-md-12 mb-3">
          <label for="nombre">Área:</label>

          <select formControlName="office_id" required class="form-control">
            <!-- <option value="-1" selected>Seleccione una opción</option> -->
            <option [value]="null" disabled>Seleccione una opción</option>
            <option *ngFor="let item of arrOficina" [value]="item.id">
              {{ item.oficina_name }}
            </option>
          </select>
        </div>
        <div class="form-group col-md-12 mb-3">
          <label for="correo">Módulo:</label>
          <input
            class="form-control"
            type="text"
            id="correo"
            formControlName="area_name"
          />
        </div>

        <div class="col-md-12" style="display: flex; justify-content: flex-end">
          <button
            class="btn btn-outline-info btn-rounded"
            style="margin-right: 20px"
            (click)="cerrarModal()"
          >
            Cancelar
          </button>
          <div>
            <button
              *ngIf="!workback"
              class="btn btn-outline-info btn-rounded"
              type="button"
              (click)="agregar()"
            >
              Agregar
            </button>
            <div class="spinner spinner-primary mr-3" *ngIf="workback"></div>
          </div>
        </div>
      </div>
    </form>
  </div>
</ng-template>

<ng-template #modalEdit let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-title">Editar Módulo</h4>
    <button
      type="button"
      class="close"
      aria-label="Close button"
      aria-describedby="modal-title"
      (click)="modal.dismiss('Cross click')"
    >
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div class="row" style="margin-top: 30px">
      <div class="form-group col-md-12 mb-3">
        <label for="name">Área:</label>

        <select
          [(ngModel)]="DatosArea.offices[0].id"
          [ngModelOptions]="{ standalone: true }"
          required
          class="form-control"
        >
          <option [value]="null" disabled>Seleccione una opción</option>
          <option *ngFor="let item of arrOficina" [value]="item.id">
            {{ item.oficina_name }}
          </option>
        </select>
      </div>
      <div class="form-group col-md-12 mb-3">
        <label for="correo">Módulo:</label>
        <input
          class="form-control"
          type="text"
          id="correo"
          [(ngModel)]="DatosArea.area_name"
          [ngModelOptions]="{ standalone: true }"
        />
      </div>
    </div>

    <div class="modal-footer">
      <button
        type="button"
        class="btn btn-outline-secondary btn-rounded"
        (click)="modal.dismiss('cancel')"
        [disabled]="workback"
      >
        Cancelar
      </button>
      <!-- [disabled]="!forma.valid" -->

      <div>
        <input
          class="btn btn-info btn-rounded"
          #closebutton
          (click)="editarArticuloAdmin(DatosArea.id)"
          value="Guardar cambios"
          *ngIf="!workback"
        />
        <div class="spinner spinner-primary mr-3" *ngIf="workback"></div>
      </div>
    </div>
  </div>
</ng-template>
