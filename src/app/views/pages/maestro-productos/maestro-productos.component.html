<div class="breadcrumb">
  <h1>Sets</h1>
  <ul>
    <li><a>Lista de Sets</a></li>
  </ul>
</div>
<div class="separator-breadcrumb border-top"></div>
<div class="col-md-12" style="text-align: end">
  <button
    class="btn btn-outline-info btn-rounded"
    (click)="openSetsAdd(addProductos)"
  >
    Agregar
  </button>
</div>
<div class="row mt-3">
  <div
    style="
      display: flex;
      width: 100%;
      justify-content: center;
      margin-bottom: 1rem;
    "
    *ngIf="loadData"
  >
    <div class="loader-bubble loader-bubble-info m-4"></div>
  </div>

  <div class="col-md-12">
    <div class="card o-hidden">
      <div
        style="padding-left: 20px"
        *ngIf="!allUser?.length"
        class="w-100 my-4 mx-auto"
      >
        <h4>{{ "Sin Sets agregados" }}</h4>
      </div>

      <ngx-datatable
        *ngIf="allUser?.length"
        style="box-shadow: none"
        class="material fullscreen"
        [style.height]="60 * allUser.length + 60 + 'px'"
        [columnMode]="'force'"
        [headerHeight]="50"
        [footerHeight]="0"
        [rowHeight]="60"
        [scrollbarV]="true"
        [scrollbarH]="true"
        [rows]="allUser"
      >
        <ngx-datatable-column
          [resizeable]="false"
          [sortable]="false"
          name="photo"
          [maxWidth]="100"
        >
          <ng-template
            class="my-custom-header-style"
            ngx-datatable-header-template
          >
            Foto
          </ng-template>
          <ng-template
            ngx-datatable-cell-template
            let-value="value"
            let-row="row"
          >
            <img [src]="row.path" alt="{{ row.path }}" width="50" height="50" />
          </ng-template>
        </ngx-datatable-column>

        <ngx-datatable-column [resizeable]="false" [sortable]="false">
          <ng-template ngx-datatable-header-template> Nombre </ng-template>
          <ng-template
            ngx-datatable-cell-template
            let-value="value"
            let-row="row"
          >
            {{ row.name }}
          </ng-template>
        </ngx-datatable-column>
        <ngx-datatable-column [resizeable]="false" [sortable]="false">
          <ng-template ngx-datatable-header-template> Descripciòn </ng-template>
          <ng-template
            ngx-datatable-cell-template
            let-value="value"
            let-row="row"
          >
            {{ row.description }}
          </ng-template>
        </ngx-datatable-column>

        <ngx-datatable-column [resizeable]="false" [sortable]="false">
          <ng-template ngx-datatable-header-template>
            Ficha tècnica
          </ng-template>
          <ng-template
            ngx-datatable-cell-template
            let-value="value"
            let-row="row"
          >
            {{ row.technical_specification }}
          </ng-template>
        </ngx-datatable-column>

        <ngx-datatable-column [resizeable]="false" [sortable]="false">
          <ng-template ngx-datatable-header-template> Valor </ng-template>
          <ng-template
            ngx-datatable-cell-template
            let-value="value"
            let-row="row"
          >
            {{ row.price }}
          </ng-template>
        </ngx-datatable-column>

        <ngx-datatable-column [resizeable]="false" [sortable]="false">
          <ng-template ngx-datatable-header-template> Moneda </ng-template>
          <ng-template
            ngx-datatable-cell-template
            let-value="value"
            let-row="row"
          >
            {{ row.currency }}
          </ng-template>
        </ngx-datatable-column>

        <ngx-datatable-column [resizeable]="false" [sortable]="false">
          <ng-template ngx-datatable-header-template> Marca </ng-template>
          <ng-template
            ngx-datatable-cell-template
            let-value="value"
            let-row="row"
          >
            {{ row.brand }}
          </ng-template>
        </ngx-datatable-column>

        <ngx-datatable-column [resizeable]="false" [sortable]="false">
          <ng-template ngx-datatable-header-template> Estado </ng-template>
          <ng-template
            ngx-datatable-cell-template
            let-value="value"
            let-row="row"
          >
            <a
              class="m-0 text-muted text-small w-15 w-sm-15 cortado"
              *ngIf="row.state == true"
            >
              <div
                style="
                  border: 1px solid #333366;
                  background: white;
                  color: black;
                  font-weight: 400;
                "
                class="badge badge-pill badge-success p-2 item-title"
              >
                Habilitado
              </div>
            </a>

            <a
              class="m-0 text-muted text-small w-15 w-sm-15 cortado"
              *ngIf="row.state == false"
            >
              <div
                style="
                  border: 1px solid #333366;
                  background: white;
                  color: black;
                  font-weight: 400;
                "
                class="badge badge-pill badge-success p-2 item-title"
              >
                Deshabilitado
              </div>
            </a>
          </ng-template>
        </ngx-datatable-column>

        <ngx-datatable-column
          [resizeable]="false"
          [sortable]="false"
          [width]="120"
        >
          <ng-template ngx-datatable-header-template> Acciones </ng-template>
          <ng-template
            ngx-datatable-cell-template
            let-value="value"
            let-row="row"
          >
            <button
              (click)="confirm(i, row, modalEdit)"
              class="btn btn-wide btn-outline-secondary mr-3"
            >
              Editar
            </button>
            <button
              class="btn btn-outline-danger"
              (click)="deleteInvoice(row, deleteConfirmModal)"
            >
              <a *ngIf="row.state == true">Desactivar</a>
              <a *ngIf="row.state == false">Activar</a>
            </button>
          </ng-template>
        </ngx-datatable-column>
      </ngx-datatable>

      <ngb-pagination
        style="text-align: end"
        class="paginacion-ed"
        [collectionSize]="collectionSize"
        [(page)]="page"
        [pageSize]="pageSize"
        [maxSize]="5"
        (pageChange)="cambiaPage($event)"
      >
      </ngb-pagination>
    </div>
  </div>
</div>
<ng-template #deleteConfirmModal let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-title">¡Advertencia!</h4>
    <button
      type="button"
      class="close"
      aria-label="Close button"
      aria-describedby="modal-title"
      (click)="modal.dismiss('Cross click')"
    >
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <p>
      <strong
        >¿Está seguro de <a *ngIf="eve == true">activar</a>
        <a *ngIf="eve == false">desactivar</a> el articulo?</strong
      >
    </p>
  </div>
  <div class="modal-footer">
    <button
      type="button"
      class="btn btn-outline-secondary btn-rounded"
      (click)="modal.dismiss('cancel')"
    >
      Cancel
    </button>
    <button
      type="button"
      ngbAutofocus
      class="btn btn-wide btn-danger btn-rounded"
      (click)="modal.close('Ok')"
    >
      Ok
    </button>
  </div>
</ng-template>

<ng-template #addProductos>
  <div class="modal-header">
    <h2 mat-dialog-title class="modal-title">AGREGAR Sets</h2>

    <button
      type="button"
      class="close"
      aria-label="Close"
      (click)="cerrarModal()"
    >
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <form [formGroup]="myForm">
      <div class="row" style="margin-top: 30px">
        <div class="form-group col-md-12 mb-3">
          <label for="nombre">Nombre:</label>
          <input
            class="form-control"
            type="text"
            id="nombre"
            formControlName="name"
          />
        </div>
        <div class="form-group col-md-12 mb-3">
          <label for="apellidos">Descripción:</label>
          <textarea
            class="form-control"
            type="text"
            id="apellidos"
            formControlName="description"
          ></textarea>
        </div>
        <div class="form-group col-md-12 mb-3">
          <label for="correo">Especificación Técnica:</label>
          <textarea
            class="form-control"
            type="text"
            id="correo"
            formControlName="technical_specification"
          ></textarea>
        </div>

        <div class="form-group col-md-6 mb-3">
          <label for="nombre">Moneda:</label>
          <select
            formControlName="currency"
            [ngModelOptions]="{ standalone: true }"
            class="form-control"
          >
            <!-- <option value="-1" selected>Seleccione una opción</option> -->
            <option [ngValue]="null" disabled>Seleccione una opción</option>
            <option value="dolar">Dólares</option>
            <option value="soles">Soles</option>
          </select>
        </div>

        <div class="form-group col-md-6 mb-3">
          <label for="nombre">Valor:</label>
          <input
            class="form-control"
            type="number"
            style="text-align: end"
            min="1"
            id="nombre"
            formControlName="price"
          />
        </div>

        <div class="form-group col-md-12 mb-3">
          <label for="nombre">Marca:</label>
          <input
            class="form-control"
            type="text"
            id="nombre"
            formControlName="brand"
          />
        </div>

        <div class="form-group col-md-12 mb-3">
          <label class="checkbox checkbox-info mt-2">
            <input
              id="incluirImagen"
              name="incluirImagen"
              type="checkbox"
              [(ngModel)]="incluirImagen"
              [ngModelOptions]="{ standalone: true }"
            />
            <span>Incluir imagen de sets (Se recomienda 500 x 500px)</span>
            <span class="checkmark"></span>
          </label>
        </div>

        <div class="form-group col-md-12 mb-3" *ngIf="incluirImagen">
          <div class="input-group mb-3">
            <div class="custom-file">
              <input
                type="file"
                accept=".png, .jpg, .jpeg"
                class="custom-file-input"
                id="inputGroupFile02"
                (change)="changeListener($event)"
              />
              <label
                class="custom-file-label elipsi"
                for="inputGroupFile02"
                aria-describedby="inputGroupFileAddon02"
                >{{ image ? nombreImg : "Elegir Archivo" }}</label
              >
            </div>
          </div>
          <div
            *ngIf="image"
            style="display: flex; justify-content: center"
            class="mb-4"
          >
            <img
              style="border-radius: 3px; align-self: center"
              [src]="image"
              alt=""
              height="120px"
            />
          </div>
        </div>

        <div class="col-md-12" style="text-align: end">
          <button
            class="btn btn-outline-info btn-rounded"
            style="margin-right: 20px"
            (click)="cerrarModal()"
          >
            Cancelar
          </button>
          <button
            class="btn btn-outline-info btn-rounded"
            type="button"
            (click)="agregar()"
          >
            Agregar
          </button>
        </div>
      </div>
    </form>
  </div>
</ng-template>

<ng-template #modalEdit let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-title">EDITAR Sets</h4>
    <button
      type="button"
      class="close"
      aria-label="Close button"
      aria-describedby="modal-title"
      (click)="modal.dismiss('Cross click')"
    >
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div class="row" style="margin-top: 30px">
      <div class="form-group col-md-12 mb-3">
        <label for="name">Nombres</label>
        <input
          maxlength="90"
          [(ngModel)]="DatosSets.name"
          [ngModelOptions]="{ standalone: true }"
          required
          type="text"
          class="form-control"
          autocomplete="off"
        />
      </div>
      <div class="form-group col-md-12 mb-3">
        <label for="lastname">Descripción</label>
        <input
          maxlength="90"
          [(ngModel)]="DatosSets.description"
          [ngModelOptions]="{ standalone: true }"
          required
          type="text"
          class="form-control"
          autocomplete="off"
        />
      </div>
      <div class="form-group col-md-12 mb-3">
        <label for="admin_rol_id">Especificación Técnica: </label>
        <input
          maxlength="90"
          [(ngModel)]="DatosSets.technical_specification"
          [ngModelOptions]="{ standalone: true }"
          required
          type="text"
          class="form-control"
          autocomplete="off"
        />
      </div>

      <div class="form-group col-md-6 mb-3">
        <label for="nombre">Moneda:</label>
        <select
          [(ngModel)]="DatosSets.currency"
          [ngModelOptions]="{ standalone: true }"
          required
          class="form-control"
        >
          <!-- <option value="-1" selected>Seleccione una opción</option> -->
          <option [ngValue]="null" disabled>Seleccione una opción</option>
          <option value="dolar">Dólares</option>
          <option value="soles">Soles</option>
        </select>
      </div>

      <div class="form-group col-md-6 mb-3">
        <label for="nombre">Valor:</label>
        <input
          class="form-control"
          type="number"
          style="text-align: end"
          min="1"
          id="nombre"
          [(ngModel)]="DatosSets.price"
          [ngModelOptions]="{ standalone: true }"
        />
      </div>

      <div class="form-group col-md-12 mb-3">
        <label for="nombre">Marca:</label>
        <input
          class="form-control"
          type="text"
          id="nombre"
          [(ngModel)]="DatosSets.brand"
          [ngModelOptions]="{ standalone: true }"
        />
      </div>
      <div class="form-group col-md-12 mb-3">
        <label class="checkbox checkbox-info mt-2">
          <input
            id="incluirImagen"
            name="incluirImagen"
            type="checkbox"
            disabled
            [(ngModel)]="incluirImagen"
            [ngModelOptions]="{ standalone: true }"
          />
          <span>Incluir imagen en sets</span>
          <span class="checkmark"></span>
        </label>
      </div>

      <div *ngIf="incluirImagen" class="form-group col-md-12 mb-3">
        <div class="input-group mb-3">
          <div class="custom-file">
            <input
              type="file"
              accept=".png, .jpg, .jpeg"
              class="custom-file-input"
              id="inputGroupFile02"
              (change)="changeListener($event)"
            />
            <label
              class="custom-file-label elipsi"
              for="inputGroupFile02"
              aria-describedby="inputGroupFileAddon02"
              >{{ image ? nombreImg : "Elegir Archivo" }}</label
            >
          </div>
        </div>
        <button
          *ngIf="cambioImagen1"
          type="button"
          class="btn btn-info btn-sm m-1"
          (click)="cancelarCambioImg()"
        >
          Cancelar
        </button>
        <div
          *ngIf="image"
          style="display: flex; justify-content: center"
          class="mb-4"
        >
          <img
            style="border-radius: 3px; align-self: center"
            [src]="image"
            alt=""
            height="120px"
          />
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button
        type="button"
        class="btn btn-outline-secondary btn-rounded"
        (click)="modal.dismiss('cancel')"
        [disabled]="workback"
      >
        Cancelar
      </button>
      <!-- [disabled]="!forma.valid" -->

      <div>
        <input
          class="btn btn-info btn-rounded"
          #closebutton
          (click)="editarArticuloAdmin(DatosSets.id)"
          value="Guardar cambios"
          *ngIf="!workback"
        />
        <div class="spinner spinner-primary mr-3" *ngIf="workback"></div>
      </div>
    </div>
  </div>
</ng-template>
